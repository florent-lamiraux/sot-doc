<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>sot-doc: Controllers formulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="pinocchio.ico" rel="icon" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="MathJax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sot-doc
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">Documentation entry point for the Stack-Of-Tasks</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('b_controllers_information.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Controllers formulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_ControllersFormulation"></a></p>
<h1><a class="anchor" id="NecessaryConditions"></a>
Necessary constraints</h1>
<h2><a class="anchor" id="SubSecDynamicModeling"></a>
Dynamic modeling of a free-floating multi-body system</h2>
<p>The dynamic model of a free-floating multi-body system can be written this way:</p>
<p class="formulaDsp">
\[ M(q) \ddot{q} + N(q,\dot{q}) \dot{q}+G(q)=Su \]
</p>
<p>with \(q\) the robot state variable, \( M(q) \) the inertia matrix of the multi-body system, \( N (q,\dot{q}) \) the matrix of the non-linear dynamical effect (Centrifugal and Coriolis forces) of the system motion, \( G(q) \) the gravity, \(u\) the control vector, and \( S \) the matrix mapping the control vector on the system (also called the selection matrix).</p>
<p>The current software library we are using to computate such quantities and theirs derivatives is Pinocchio 1. Pinocchio include dynamical quantities such as angular momentum and its derivatives. </p>
<h2><a class="anchor" id="SubSecContactModels"></a>
Contact models</h2>
<p>When considering a rigid contact model several constraints needs to be considered:</p><ul>
<li>No penetration in the ground</li>
<li>No sliding</li>
</ul>
<p>Both constraints generate inequalities at the contact points with respect to the state vector: </p><p class="formulaDsp">
\[ \Phi_{n,c} (q) \geq 0 \]
</p>
 <p class="formulaDsp">
\[ \Phi_{t,c} (q) \geq 0 \]
</p>
<p>with \( \Phi_{n,c}(q) \) the normal force at contact point \( c \) expressed in the local reference frame of the contact point, and \( \Phi_{t,c}(q) \) the tangential force at contact point \( c\) also expressed in the local reference frame of the contact point.</p>
<p>To avoid penetration velocity and acceleration of the points must be constrained too. Using differentiation we obtain: </p><p class="formulaDsp">
\[ C_n (q) \dot{q} = 0 \]
</p>
 <p class="formulaDsp">
\[ C_n(q) \ddot{q}+s_n(q,\dot{q})=0 \]
</p>
<p>The same derivation can be realized to avoid sliding: </p><p class="formulaDsp">
\[ C_t(q)\dot{q}=0 \]
</p>
 <p class="formulaDsp">
\[ C_t(q)\ddot{q}+s_n(q,\dot{q})=0 \]
</p>
<p>Self-collisiion is usually avoiding by formulating an inequality constraint on the distance between two robot bodies. To do that the closest two points between two shapes are tracked. The distance between two bodies is obtained through a flavor of the FCL library. </p>
<h1><a class="anchor" id="SecFunctions"></a>
Functions used to generate a robot behavior</h1>
<h2><a class="anchor" id="SubFuncFormulatingTasks"></a>
Formulating tasks</h2>
<h3><a class="anchor" id="subsubdef"></a>
Definition</h3>
<p>Task \( (e) \) are using features \((s)\). Features might be end-effector posision (hands, feet), the robot center-of-mass, or the center-of-gravity of an object projected in the image. We assume that a function relates the current state of the robot typically the configuration, speed, acceleration to a feature. For instance, we may want to consider the Center-Of-Mass of a robot specified by a model \( robot\_model \) and a configuration vector \( q\) </p><p class="formulaDsp">
\[ f_{CoM}:(robot\_model,q) \rightarrow c\]
</p>
<p>We further assume that this function is at least differentiable once. A task is then defined by the regulation between the feature depending on the current state \( s(q) \) of the robot and a desired feature \(s^*\): </p><p class="formulaDsp">
\[ e=s(q)−s^*\]
</p>
<h3><a class="anchor" id="subsubImposingTaskDyn"></a>
Imposing the task dynamic</h3>
<p>You can impose for instance that the task dynamic is an exponential decay: </p><p class="formulaDsp">
\[ \dot{e}=−λe \]
</p>
<p> But we also have: </p><p class="formulaDsp">
\[ \dot{e}=\dot{s}(q)−\dot{s}^∗\]
</p>
<p>If the desired feature does not move we have</p>
<p class="formulaDsp">
\[ \dot{s}^∗=0 \]
</p>
<p> in addition we can remark that </p><p class="formulaDsp">
\[\dot{s}(q)=\frac{\delta s}{\delta q}\dot{q}=J(q)\dot{q} \]
</p>
<p> Thus </p><p class="formulaDsp">
\[ \dot{e}=J(q)\dot{q}−\dot{s}^∗ \]
</p>
<p>At a given time \( t=k \Delta T \) a measurement of the feature \( \hat{s}(t) \) can give us: </p><p class="formulaDsp">
\[ \hat{e}(t)=\hat{s}(t)−s^∗(t) \]
</p>
<p> By posing </p><p class="formulaDsp">
\[ \hat{e}(t)=e(t) \]
</p>
<p> we have: </p><p class="formulaDsp">
\[ \dot{e}(t)=−\lambda e(t)=−\lambda \hat{e}(t)= −\lambda ( \hat{s}(t)−s^*(t)) \]
</p>
<p>We will continue by dropping \( (t) \) for sake of clarity: </p><p class="formulaDsp">
\[ − \lambda ( \hat{s}− s^∗) = J(q)\dot{q} \]
</p>
<p>Therefore if \( J(q) \) is invertible we can find \( \dot{q} \) using the following relationship: </p><p class="formulaDsp">
\[ \dot{q}=− \lambda J(q)^{−1}(\hat{s}−s^∗) \]
</p>
<p>In general \( J(q) \) is not square and then we have to use the Moore-Penrose pseudo inverse: </p><p class="formulaDsp">
\[ \dot{q}= −\lambda J(q)^+(\hat{s}−s^∗) \]
</p>
<p>But it can be also understood as the solution of the following optimization problem: </p><p class="formulaDsp">
\[ \begin{matrix} argmin_{ \dot{q}} || \dot{q} || &amp; \\ s.t. &amp; − \lambda (\hat{s} - s^∗) =J(q)\dot{q} \\ \end{matrix} \]
</p>
<ul>
<li>The library implementing the task formulation in velocity domain is <a href="http://github.com/stack-of-tasks/sot-core">sot-core</a> (Hierarchy).</li>
<li>The library implementing the task formulation in acceleration is <a href="http://github.com/stack-of-tasks/sot-dyninv">sot-dyninv</a> (Hierarchy with inequalities).</li>
<li>The library implementing the task formulation in torque is <a href="http://github.com/stack-of-tasks/sot-torque-control">sot-torque-control</a> (Weighted sum).</li>
</ul>
<h2><a class="anchor" id="SubsectionFormulatingInstantaneousControl"></a>
Formulating instantaneous control as optimization problem</h2>
<p>The task function is allowing a very versatile formulation including:</p><ul>
<li>Hierarchy of tasks: Each task at a level \( i\) cannot interfer with the control at level \(i-1\). This concept has been introduced by Nakamura <a class="el" href="citelist.html#CITEREF_Nakamura:ijrr:87">[10]</a> extended by Siciliano in <a class="el" href="citelist.html#CITEREF_Siciliano:icarrue:91">[16]</a> .</li>
<li>Weighted problems: Each task are at the same level i.e. they are all included in the same cost function, and they are weighted against each other. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
