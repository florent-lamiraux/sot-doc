<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>sot-doc: Using catkin tools and vcs for the SoT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="pinocchio.ico" rel="icon" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="MathJax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sot-doc
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('memo_catkin_tools.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using catkin tools and vcs for the SoT </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="memo_catkin_tools_intro"></a>
Introduction</h1>
<p>This memo explains how to create and handle a super build (set of packages) workspace of the SoT with catkin tools. catkin tools should not confused with catkin_make. They can be installed independently from ROS.</p>
<p>Two solutions are possible:</p>
<ul>
<li>Installing the SoT third party dependency from robotpkg binaries.</li>
<li>Installing the SoT third party dependency from robotpkg sources.</li>
</ul>
<p>The first solution is the fastest and is recommended to stay up-to-date with the core development team. The disadvantage is that the software environment might be unstable if the binary packages are updated continously.</p>
<p>To have a stable environment it is possible to freeze the binary packages coming from robotpkg (by imposing the version) or to use the second solution.</p>
<p>Practically it is possible to have both the binary packages in <code>/opt/openrobots</code> to follow the latest development and to have the source packages in <code>/home/user/own_stable_install</code> develop your own functionnalities.</p>
<p>The last solution is to use docker.</p>
<h2><a class="anchor" id="memo_catkin_tools_quick_start"></a>
Quick start</h2>
<h3><a class="anchor" id="memo_catkin_tools_quick_start_required"></a>
Required packages</h3>
<p>Running the following script will install the necessary SoT software dependency, but first you will need a few packages to be able to run it. To install them, run : </p><pre class="fragment">sudo apt install ccache libncurses5-dev pax texlive-latex-extra doxygen assimp-utils python3-notify2 python3-lark-parser
</pre><p>Some ros packages are required as well. For ros melodic you can run: </p><pre class="fragment">sudo apt install ros-melodic-octomap ros-melodic-orocos-kinematics-dynamics ros-melodic-four-wheel-steering-msgs ros-melodic-urdf-geometry-parser
</pre><p>For kinetic, run: </p><pre class="fragment">sudo apt install ros-kinetic-octomap ros-kinetic-orocos-kinematics-dynamics ros-kinetic-four-wheel-steering-msgs ros-kinetic-urdf-geometry-parser
</pre><h3><a class="anchor" id="memo_catkin_tools_quick_start_depends"></a>
Install dependencies</h3>
<p>To install the necessary SoT software dependency in <code>/path_to_target_dir</code> you can simply try: </p><pre class="fragment">wget -O install-dep-thru-rpkg.sh https://raw.githubusercontent.com/stack-of-tasks/sot-doc/master/bash/install-dep-thru-rpkg.sh
chmod +x ./install-dep-thru-rpkg.sh
./install-dep-thru-rpkg.sh -p /path_to_target_dir -s /path_to_robotpkg_src
</pre><p>This will install the binairies in <code>/path_to_target_dir</code> and store the sources in <code>/path_to_robotpkg_src</code>.</p>
<p>Other options to install the source dependencies are given in <a class="el" href="memo_catkin_tools.html#memo_preparing_environment">Installing dependencies</a>.</p>
<h3><a class="anchor" id="memo_catkin_tools_quick_start_setnv"></a>
Setup your environment</h3>
<pre class="fragment">source setup-sot.sh -p /path_to_target_dir -r
source setup-sot.sh -p /path_to_sot_ws/install -r
</pre><h3><a class="anchor" id="_catkin_tools_quick_create_ws"></a>
Create your workspace</h3>
<p>You will then need some tools: one for version control, the other for your workspace </p><pre class="fragment">sudo apt install python3-vcstool python3-catkin-tools
</pre><p>Once this is done,to create your SoT workspace using the file <a href="https://github.com/stack-of-tasks/sot-doc/blob/master/config/sot_talos.repos">sot_talos.repos</a>: </p><pre class="fragment">wget -O install-sot-catkin-ws.sh https://raw.githubusercontent.com/stack-of-tasks/sot-doc/master/bash/install-sot-catkin-ws.sh
chmod +x ./install-sot-catkin-ws.sh
./install-sot-catkin-ws.sh -p /path_to_sot_ws
</pre><h2><a class="anchor" id="memto_catkin_tools_quick_start_explanations"></a>
Quick start explanations</h2>
<p>The previous script is doing the following steps: </p><pre class="fragment">mkdir -p /path_to_sot_ws
cd /path_to_sot_ws
wget -O sot_talos.repos https://raw.githubusercontent.com/stack-of-tasks/sot-doc/master/config/sot_talos.repos
vcs import --recursive &lt; sot_talos.repos
# configure your catkin environment
</pre><p>To build everything you can simply type: </p><pre class="fragment">catkin build
</pre><p>The cmake arguments are explained in more details in <a class="el" href="memo_catkin_tools.html#memo_catkin_tools_compiling">Compiling and testing the packages (catkin)</a></p>
<h1><a class="anchor" id="memo_catkin_tools_vcs"></a>
Handling the repositories (VCS)</h1>
<h2><a class="anchor" id="memo_catkin_tools_vcs_checkingout"></a>
Checking out the SoT infra-structure</h2>
<p>The set of repositories can be handled using the <a href="https://github.com/dirk-thomas/vcstool">vcs software</a></p>
<p>The repositories for the SoT can be specified in a file sot_talos.repos as follows: </p><pre class="fragment">repositories:
    others/robotpkg_helpers:
        type: git
        url: https://github.com/stack-of-tasks/robotpkg_helpers.git
        version: master
    src/dynamic-graph:
        type: git
        url: https://github.com/stack-of-tasks/dynamic-graph.git
        version: master
    src/dynamic-graph-python:
        type: git
        url: https://github.com/stack-of-tasks/dynamic-graph-python.git
        version: master
    src/dynamic_graph_bridge:
        type: git
        url: https://github.com/stack-of-tasks/dynamic_graph_bridge.git
        version: master
    src/dynamic_graph_bridge_msgs:
        type: git
        url: https://github.com/stack-of-tasks/dynamic_graph_bridge_msgs.git
        version: master
    src/jrl-walkgen:
        type: git
        url: https://github.com/stack-of-tasks/jrl-walkgen.git
        version: master
    src/roscontrol_sot:
        type: git
        url: https://github.com/stack-of-tasks/roscontrol_sot.git
        version: master
    src/sot-core:
        type: git
        url: https://github.com/stack-of-tasks/sot-core.git
        version: master
    src/sot-doc:
        type: git
        url: https://github.com/stack-of-tasks/sot-doc.git
        version: master
    src/sot-dynamic-pinocchio:
        type: git
        url: https://github.com/stack-of-tasks/sot-dynamic-pinocchio.git
        version: master
    src/sot-pattern-generator:
        type: git
        url: https://github.com/stack-of-tasks/sot-pattern-generator.git
        version: master
    src/sot-talos:
        type: git
        url: https://github.com/stack-of-tasks/sot-talos.git
        version: master
    src/sot-talos-balance:
        type: git
        url: https://github.com/loco-3d/sot-talos-balance.git
        version: master
    src/sot-tools:
        type: git
        url: https://github.com/stack-of-tasks/sot-tools.git
        version: master
    src/sot-torque-control:
        type: git
        url: https://github.com/stack-of-tasks/sot-torque-control.git
        version: master
    src/talos_data:
        type: git
        url: https://github.com/stack-of-tasks/talos_data.git
        version: master
    src/talos_metapkg_ros_control_sot:
        type: git
        url: https://github.com/stack-of-tasks/talos_metapkg_roscontrol_sot.git
        version: master
    src/tsid:
        type: git
        url: https://github.com/stack-of-tasks/tsid.git
        version: master
</pre><p>To import all the repositories: </p><pre class="fragment">vcs import --recursive &lt; sot_talos.repos
</pre><p>You can create your own file by going in the src directory of your workspace, and then type: </p><pre class="fragment">vcs export --repos &gt; sot_talos.repos
</pre><h2><a class="anchor" id="memo_catkin_tools_vcs_status"></a>
Getting the current status of the repos</h2>
<p>In the src directory of the workspace </p><pre class="fragment">vcs status -quiet
</pre><h2><a class="anchor" id="memo_catkin_tools_vcs_status"></a>
Getting the current status of the repos</h2>
<p>In the root directory of the worspace </p><pre class="fragment">vcs pull
</pre><p>This will pull the current branch from its upstream remote server.</p>
<h1><a class="anchor" id="memo_catkin_tools_compiling"></a>
Compiling and testing the packages (catkin)</h1>
<h2><a class="anchor" id="memo_catkin_tools_compiling_settings"></a>
Setting the cmake args</h2>
<p>For instance we want to force the system to be in debug mode and to set some variables we can use the following command: </p><pre class="fragment">cd /path_to_sot_ws
catkin config --install --cmake-args -DCMAKE_BUILD_TYPE=DEBUG
</pre><p>It forces the package to be installed in the install folder, and forces all the CMake aware packages to be compiled in DEBUG mode.</p>
<p>A more involved example is the following: </p><pre class="fragment">local_cmake_args="--cmake-args -DCMAKE_BUILD_TYPE=DEBUG "
local_cmake_args="${local_cmake_args} -DPYTHON_STANDARD_LAYOUT:BOOL=ON"
local_cmake_args="${local_cmake_args} -DPYTHON_DEB_LAYOUT:BOOL=OFF"
local_cmake_args="${local_cmake_args} -DSETUPTOOLS_DEB_LAYOUT:BOOL=OFF"
local_cmake_args="${local_cmake_args} -DCMAKE_CXX_FLAGS=\"-std=c++1\""
catkin_config_args="--install -w /path_to_sot_ws"
catkin_config_args="${catking_config_args} ${local_cmake_args}"
catkin config ${catkin_config_args} --
</pre><h2><a class="anchor" id="memo_catkin_tools_compiling_compiling"></a>
Compiling</h2>
<h3><a class="anchor" id="memo_catkin_tools_compiling_all"></a>
Compiling everything</h3>
<pre class="fragment">catkin build
</pre><h3><a class="anchor" id="memo_catkin_tools_compiling_a_pkg"></a>
Compiling a specific package with its dependencies</h3>
<p>For instance the following command is compiling the dynamic-graph-python package:</p>
<pre class="fragment">catkin build dynamic-graph-python
</pre><h3><a class="anchor" id="memo_catkin_tools_compiling_a_pkg_nodeps"></a>
Compiling a specific package without its dependencies</h3>
<p>For instance the following command is compiling the dynamic-graph-python package:</p>
<pre class="fragment">catkin build dynamic-graph-python --no-deps
</pre><h3><a class="anchor" id="memo_catkin_tools_compiling_a_pkg_doc"></a>
Generating the documentation</h3>
<p>For instance the following command is generating the documentation for the sot-core package: </p><pre class="fragment">catkin build sot-core --no-deps --make-args doc
</pre><h2><a class="anchor" id="memo_catkin_tools_clean_all"></a>
Clean all the build part</h2>
<pre class="fragment">catkin clean
</pre><h2><a class="anchor" id="memo_catkin_tools_run_tests"></a>
Running tests</h2>
<p>Example running the test programs of the package dynamic-graph-python in the workspace root directory:</p>
<pre class="fragment">catkin test dynamic-graph-python
</pre><p>Note: make sure that the install directory is specified in the environment variables LD_LIBRARY_PATH and PYTHONPATH for instance. By default <em>all</em> dependent packages will also run the tests. To prevent this it is highly recommended to use:</p>
<pre class="fragment">catkin test dynamic-graph-python --no-deps
</pre><h2><a class="anchor" id="memo_catkin_tools_compute_coverage"></a>
Computing coverage</h2>
<p>You need to add to the CXX_FLAGS and the LD_FLAGS the value &ndash;coverage:</p>
<pre class="fragment">catkin config --append --cmake-args -DCMAKE_CXX_FLAGS="--coverage" -DCMAKE_LD_FLAGS="--coverage"
</pre><p>Then run the test: </p><pre class="fragment">catkin test dynamic-graph-python
</pre><p>And in the workspace root directory you need to run: </p><pre class="fragment">gcovr -r . --html --html-details -o ./logs/coverage/index.html
</pre><p>To get the output of the coverage: </p><pre class="fragment">firefox ./logs/coverage/index.html
</pre><h1><a class="anchor" id="memo_preparing_environment"></a>
Installing dependencies</h1>
<p>They are several ways to install the dependencies of the SoT from sources in a target directory <code>/path_to_target_dir</code> We gave here two methods to install the necessary software environment for the Stack-of-Tasks. To illustrate the process the Talos humanoid robot related packages are used.</p>
<h2><a class="anchor" id="subsec_preparing_env_from_rpkg_bash"></a>
Quick start</h2>
<p>To install the necessary SoT software dependency in '''/path_to_target_dir``` you can simply try: </p><pre class="fragment">wget -O install-dep-thru-rpkg.sh https://raw.githubusercontent.com/stack-of-tasks/sot-doc/master/bash/install-dep-thru-rpkg.sh
chmod +x ./install-dep-thru-rpkg.sh
./install-dep-thru-rpkg.sh -p /path_to_target_dir -s /path_to_robotpkg_src
</pre><p>The robotpkg source directory will be stored in <code>/path_to_robotpkg_src</code></p>
<h2><a class="anchor" id="subsec_preparing_env_from_rpkg_only"></a>
Robotpkg Only</h2>
<p>You can install the package management system <a href="http://robotpkg.openrobots.org/">robotpkg</a> as detailed in <a class="el" href="c_installation_detailed.html#installation_from_source">Installing from source</a> . During the procedure make sure that prefix is set to <code>/path_to_target_dir</code>.</p>
<h2><a class="anchor" id="subsec_preparing_env_from_rpkg_helpers"></a>
Robotpkg helpers repository</h2>
<p>An intermediate solution between the two previous solution is to use a tool which configure robotpkg. It is done through the following steps:</p>
<p>Clone the following repository : </p><pre class="fragment">git clone robotpkg_helpers https://github.com/olivier-stasse/robotpkg_helpers
</pre><p>Modify the following JSON file: </p><pre class="fragment">{"arch_dist_files": "arch_distfiles",
 "archives": "archives",
 "ramfs_mnt_pt": "openrobots",
 "repo_robotpkg_wip": "https://git.openrobots.org/robots/robotpkg/robotpkg-wip.git",
 "repo_robotpkg_main": "https://git.openrobots.org/robots/robotpkg.git",
 "robotpkg_mng_root": "/integration_tests",
 "robotpkg_mng_base": "/integration_tests/openrobots",
 "robotpkg_mng_src": "/integration_tests/test-openrobots-src",
 "rc_pkgs":
 {},
 "ssh_git_openrobots": false,
 "targetpkgs": ["talos-simulation","pinocchio","py-pinocchio","py-eigenpy",
            "simple-humanoid-description","eiquadprog","parametric-curves"]
}
</pre><p>You can set the variable <code>robotpkg_mng_base</code> to <code>/path_to_target_dir</code>. This where all the binaries, libraries, ros packages and documentation will be installed. The variable <code>robotpkg_mng_src</code> specifies where the robotpkg sources are stored.</p>
<h2><a class="anchor" id="subsec_preparing_env_chaining_ws"></a>
Chaining workspaces</h2>
<p>To chain the workspace you can either follow this tutorial </p><pre class="fragment">http://wiki.ros.org/catkin/Tutorials/workspace_overlaying
</pre><p>with the workspace where all the SoT packages are located, or make an alias calling the script <a href="https://github.com/stack-of-tasks/sot-doc/blob/master/bash/setup-sot.sh">setup-sot.sh</a> </p><pre class="fragment">source setup-sot.sh -p /path_to_target_dir -r
source setup-sot.sh -p /path_to_sot_ws/install -r</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Aug 19 2020 13:37:44 for sot-doc by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
